{"uid":"142b11d6585514d7","name":"test_get_model_settings_fallback_to_env","fullName":"tests.test_llm.TestModelSettings#test_get_model_settings_fallback_to_env","historyId":"71b8f60279f12ea8b0636ef7c8935518","time":{"start":1754996426887,"stop":1754996426900,"duration":13},"status":"broken","statusMessage":"KeyError: 'api_key'","statusTrace":"self = <test_llm.TestModelSettings object at 0x7f5c04378ce0>, db_init = None\napproved_user = <CustomUser: testuser>\n\n    def test_get_model_settings_fallback_to_env(self, db_init, approved_user):\n        llm = Llm()\n        model_class = \"ChatOpenAI\"\n    \n        # Create mock AIModelConfig without API key\n        config = AIModelConfig(\n            user=approved_user,  # Use the approved_user fixture\n            chat_model=model_class,\n            settings={\"temperature\": 0.7},\n        )\n    \n        with (\n            patch(\n                \"lexiflux.models.AIModelConfig.get_or_create_ai_model_config\", return_value=config\n            ),\n            patch(\n                \"lexiflux.language.llm.settings\", create=True, new_callable=MagicMock\n            ) as mock_settings,\n        ):\n            mock_settings.OPENAI_API_KEY = \"env_key\"\n            settings = llm.get_model_settings(approved_user, model_class)\n>           assert settings[\"api_key\"] == \"env_key\"\n                   ^^^^^^^^^^^^^^^^^^^\nE           KeyError: 'api_key'\n\ntests/test_llm.py:326: KeyError","flaky":false,"newFailed":false,"newBroken":true,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1754996381642,"stop":1754996381731,"duration":89},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_fail_for_invalid_template_variable","time":{"start":1754996381731,"stop":1754996381731,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"use_non_threaded_server","time":{"start":1754996381732,"stop":1754996381732,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_test_environment","time":{"start":1754996381732,"stop":1754996381732,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_blocker","time":{"start":1754996381733,"stop":1754996381733,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_use_migrations","time":{"start":1754996381733,"stop":1754996381733,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_createdb","time":{"start":1754996381733,"stop":1754996381733,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_modify_db_settings_xdist_suffix","time":{"start":1754996381733,"stop":1754996381733,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_modify_db_settings_tox_suffix","time":{"start":1754996381733,"stop":1754996381733,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_keepdb","time":{"start":1754996381733,"stop":1754996381733,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_setup","time":{"start":1754996381734,"stop":1754996384136,"duration":2402},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_modify_db_settings_parallel_suffix","time":{"start":1754996381734,"stop":1754996381734,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_modify_db_settings","time":{"start":1754996381734,"stop":1754996381734,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_setup_unittest","time":{"start":1754996425713,"stop":1754996425713,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_clear_site_cache","time":{"start":1754996426301,"stop":1754996426302,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_dj_autoclear_mailbox","time":{"start":1754996426301,"stop":1754996426301,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_db_marker","time":{"start":1754996426302,"stop":1754996426302,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch","time":{"start":1754996426302,"stop":1754996426302,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"mock_detect_language","time":{"start":1754996426302,"stop":1754996426303,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_template_string_if_invalid_marker","time":{"start":1754996426302,"stop":1754996426302,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_set_urlconf","time":{"start":1754996426302,"stop":1754996426302,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_live_server_helper","time":{"start":1754996426302,"stop":1754996426302,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_db_helper","time":{"start":1754996426303,"stop":1754996426304,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"db","time":{"start":1754996426304,"stop":1754996426304,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"db_init","time":{"start":1754996426304,"stop":1754996426460,"duration":156},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"user","time":{"start":1754996426460,"stop":1754996426884,"duration":424},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"language","time":{"start":1754996426884,"stop":1754996426885,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"approved_user","time":{"start":1754996426885,"stop":1754996426886,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"status":"broken","statusMessage":"KeyError: 'api_key'","statusTrace":"self = <test_llm.TestModelSettings object at 0x7f5c04378ce0>, db_init = None\napproved_user = <CustomUser: testuser>\n\n    def test_get_model_settings_fallback_to_env(self, db_init, approved_user):\n        llm = Llm()\n        model_class = \"ChatOpenAI\"\n    \n        # Create mock AIModelConfig without API key\n        config = AIModelConfig(\n            user=approved_user,  # Use the approved_user fixture\n            chat_model=model_class,\n            settings={\"temperature\": 0.7},\n        )\n    \n        with (\n            patch(\n                \"lexiflux.models.AIModelConfig.get_or_create_ai_model_config\", return_value=config\n            ),\n            patch(\n                \"lexiflux.language.llm.settings\", create=True, new_callable=MagicMock\n            ) as mock_settings,\n        ):\n            mock_settings.OPENAI_API_KEY = \"env_key\"\n            settings = llm.get_model_settings(approved_user, model_class)\n>           assert settings[\"api_key\"] == \"env_key\"\n                   ^^^^^^^^^^^^^^^^^^^\nE           KeyError: 'api_key'\n\ntests/test_llm.py:326: KeyError","steps":[],"attachments":[{"uid":"75369b302f9369e2","name":"log","source":"75369b302f9369e2.txt","type":"text/plain","size":213},{"uid":"58254c3916c6516e","name":"stderr","source":"58254c3916c6516e.txt","type":"text/plain","size":223}],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":2,"stepsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"_django_db_helper::0","time":{"start":1754996427076,"stop":1754996427077,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"mock_detect_language::0","time":{"start":1754996427078,"stop":1754996427078,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"monkeypatch::0","time":{"start":1754996427079,"stop":1754996427079,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_set_urlconf::0","time":{"start":1754996427080,"stop":1754996427080,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_live_server_helper::0","time":{"start":1754996427080,"stop":1754996427080,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_django_setup_unittest::0","time":{"start":1754996427082,"stop":1754996427082,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_db_setup::0","time":{"start":1754996515460,"stop":1754996515461,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"use_non_threaded_server::0","time":{"start":1754996515484,"stop":1754996515484,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"django_test_environment::0","time":{"start":1754996515486,"stop":1754996515487,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_fail_for_invalid_template_variable::0","time":{"start":1754996515489,"stop":1754996515489,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"stepsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"epic","value":"Language Tools"},{"name":"feature","value":"Model Settings"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_llm"},{"name":"subSuite","value":"TestModelSettings"},{"name":"host","value":"pkrvmsl9tci6h6u"},{"name":"thread","value":"3816-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_llm"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Test defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":0,"broken":2,"skipped":0,"passed":242,"unknown":0,"total":244},"items":[{"uid":"782d10ea774331cb","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/741/index.html#testresult/782d10ea774331cb","status":"passed","time":{"start":1754990556461,"stop":1754990556474,"duration":13}},{"uid":"7aaa80ba63e9bbff","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/740/index.html#testresult/7aaa80ba63e9bbff","status":"passed","time":{"start":1754021564858,"stop":1754021564870,"duration":12}},{"uid":"8c1e12739970c264","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/739/index.html#testresult/8c1e12739970c264","status":"passed","time":{"start":1753974928700,"stop":1753974928719,"duration":19}},{"uid":"22b187bb9b5bbcf4","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/738/index.html#testresult/22b187bb9b5bbcf4","status":"passed","time":{"start":1753951022247,"stop":1753951022260,"duration":13}},{"uid":"c470340473f85a9a","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/737/index.html#testresult/c470340473f85a9a","status":"passed","time":{"start":1753849576527,"stop":1753849576548,"duration":21}},{"uid":"f0dd3e2f2ba34740","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/736/index.html#testresult/f0dd3e2f2ba34740","status":"passed","time":{"start":1753848183082,"stop":1753848183104,"duration":22}},{"uid":"c10b943fd13934fa","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/735/index.html#testresult/c10b943fd13934fa","status":"passed","time":{"start":1753771921599,"stop":1753771921611,"duration":12}},{"uid":"176df4f1b5cf7ed","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/734/index.html#testresult/176df4f1b5cf7ed","status":"passed","time":{"start":1753676199689,"stop":1753676199700,"duration":11}},{"uid":"12bd9c9f44446ef1","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/733/index.html#testresult/12bd9c9f44446ef1","status":"passed","time":{"start":1753623236510,"stop":1753623236523,"duration":13}},{"uid":"1abc4f0044da0c17","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/732/index.html#testresult/1abc4f0044da0c17","status":"passed","time":{"start":1753508690094,"stop":1753508690105,"duration":11}},{"uid":"d61f0b5da2f0041d","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/731/index.html#testresult/d61f0b5da2f0041d","status":"passed","time":{"start":1753369463233,"stop":1753369463244,"duration":11}},{"uid":"33aca21fdc8a57b1","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/730/index.html#testresult/33aca21fdc8a57b1","status":"passed","time":{"start":1750665556297,"stop":1750665556308,"duration":11}},{"uid":"20a127255f32f0e7","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/729/index.html#testresult/20a127255f32f0e7","status":"passed","time":{"start":1750588452646,"stop":1750588452660,"duration":14}},{"uid":"1e49f6863390eb74","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/728/index.html#testresult/1e49f6863390eb74","status":"passed","time":{"start":1750587829316,"stop":1750587829327,"duration":11}},{"uid":"75b2022e33abd46b","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/727/index.html#testresult/75b2022e33abd46b","status":"passed","time":{"start":1750518231561,"stop":1750518231572,"duration":11}},{"uid":"fa107305ec538208","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/726/index.html#testresult/fa107305ec538208","status":"passed","time":{"start":1750500963931,"stop":1750500963951,"duration":20}},{"uid":"9244237420d57313","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/725/index.html#testresult/9244237420d57313","status":"passed","time":{"start":1750499336691,"stop":1750499336703,"duration":12}},{"uid":"ea03c57bea2d268","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/724/index.html#testresult/ea03c57bea2d268","status":"passed","time":{"start":1750497250110,"stop":1750497250119,"duration":9}},{"uid":"33f4e729761812c6","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/723/index.html#testresult/33f4e729761812c6","status":"passed","time":{"start":1750047913019,"stop":1750047913037,"duration":18}},{"uid":"18c2554de82ccbc1","reportUrl":"https://andgineer.github.io/lexiflux/builds/tests/722/index.html#testresult/18c2554de82ccbc1","status":"passed","time":{"start":1750047407100,"stop":1750047407119,"duration":19}}]},"tags":[]},"source":"142b11d6585514d7.json","parameterValues":[]}