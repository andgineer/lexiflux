{% extends "base.html" %}
{% block content %}

    <nav class="navbar">
        <div class="container-fluid d-flex align-items-center justify-content-between">
        <button
            class="btn btn-primary"
            id="prev-button"
            hx-get="{% url 'previous-page' %}"
            hx-target="#word-container"
            hx-swap="innerHTML">
            &#8592; <!-- Left arrow -->
        </button>

        <div class="button-title-spacer"></div>
        <div class="mx-3 text-truncate" style="flex-grow: 1;">
            {{ book.title }}
        </div>
        <div class="button-title-spacer"></div>

        <button
            class="btn btn-primary"
            id="next-button"
            hx-get="{% url 'next-page' %}"
            hx-target="#word-container"
            hx-swap="innerHTML">
            &#8594; <!-- Right arrow -->
        </button>
        </div>
    </nav>

    <div id="word-container" class="container-fluid">
        {%  include "page.html" %}
    </div>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
                Next
        </div>
    </nav>

    <script>
        document.body.addEventListener('htmx:configRequest', function(event) {
            // Add page and book parameters to all HTMX requests
            let page = {{ page.number }};
            let book = {{ book.id }};
            event.detail.parameters['page-num'] = page;
            event.detail.parameters['book-id'] = book;

            // Detect last word for the next button
            if (event.target.id === 'next-button') {
                let container = document.getElementById('word-container');
                let words = document.querySelectorAll('.word');
                let containerRect = container.getBoundingClientRect();
                let lastVisibleWordId = null;

                for (let word of words) {
                    let wordRect = word.getBoundingClientRect();
                    if (wordRect.top >= containerRect.top && wordRect.bottom <= containerRect.bottom) {
                        lastVisibleWordId = word.id;
                    } else {
                        // Exit the loop when the first invisible word is encountered
                        break;
                    }
                }
                if (lastVisibleWordId) {
                    event.detail.parameters['last-word-id'] = lastVisibleWordId.replace('word-', '');
                }
            }
        });

        document.body.addEventListener('htmx:afterSwap', function(event) {
            // Trigger a resize event to prompt Bootstrap to recalculate the layout
            window.dispatchEvent(new Event('resize'));
        });
    </script>

{% endblock %}
